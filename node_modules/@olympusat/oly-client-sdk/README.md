#### Usage
To add the Authentication gate and the Centralizer to your project:
1. Include the oly sdk package
2. Import the Gate & instantiate it with your branding info and credentials


```
import {Gate} from '@olympusat/oly-sdk';

/**
 * Instantiate the sdk Gate & the AuthService
 */
const debugHooks = true,
    hookLogger = debugHooks ? console.log : ()=>{};
    
const gate = new Gate({ 
    //logo:'https://assets.marketspace.tv/images/marketspace_logo_dark.png',
    brandingColor: '#103463',
    gateScreenBackgroundColor: '#fff',// If false it reverts to default grey, if transparent it exists as a modal
    gateScreenBackgroundImage: 'https://assets.marketspace.tv/images/landing_bg.jpg',// If false, reverts to color
    centralizerAppsIconColor: '#efefef',
    hideAppCentralizer : true,
    profileSettingsLink : '/account',
    title:'',
    displayOnAuthPage : true,// If true, the gate will pop up over page as a modal otherwise it will redirect to /auth page
    onLoginRedirectTo:'/market',// For use with the displayOnAuthPage prop to redirect user after successful login
    APP_CLIENT_ID,
    USER_POOL_ID,
    IDENTITY_POOL_ID,
    ENDPOINT_USERS,   
    ENDPOINT_GROUPS,
    ENDPOINT_APPS,
    IoT:{
        // the iot portion of the sdk requires the npm package aws-iot-device-sdk. It has to be installed here in the parent project
        // topicName: "system/broadcast",
        topicName: "alexa/query",
        clientId: APP_CLIENT_ID,
        host: IOT_HOST,
        authRol: IOT_AUTH_ROL,
        onPushNotification : (topic, payload)=>{
            console.log('in App.js Notification',topic, payload);
        },
        
    },
    events:{
        onGateShow : (args,options)=>hookLogger('HOOK | onGateShow',args,options),
        onGateHide : (args,options)=>hookLogger('HOOK | onGateHide',args,options),

        onCentralizerShow : (args,options)=>hookLogger('HOOK | onCentralizerShow',args,options),
        onCentralizerHide : (args,options)=>hookLogger('HOOK | onCentralizerHide',args,options), 

        onCentralizerAppsOpen : (args,options)=>hookLogger('HOOK | onCentralizerAppsOpen',args,options), 
        onCentralizerAppsClose : (args,options)=>hookLogger('HOOK | onCentralizerAppsClose',args,options),

        onCentralizerUserOpen : (args,options)=>hookLogger('HOOK | onCentralizerUserOpen',args,options), 
        onCentralizerUserClose : (args,options)=>hookLogger('HOOK | onCentralizerUserClose',args,options), 

        onLoginSuccess : (args,options)=>hookLogger('HOOK | onLoginSuccess',args,options),
        onLoginFail : (args,options)=>hookLogger('HOOK | onLoginFail',args,options),
    
        onLogoutSuccess : (args,options)=>hookLogger('HOOK | onLogoutSuccess',args,options),
        onLogoutFail : (args,options)=>hookLogger('HOOK | onLogoutFail',args,options),

        onPasswordResetSuccess : (args,options)=>hookLogger('HOOK | onPasswordResetSuccess',args,options),
        onPasswordResetInputVerificationCodeSuccess : (args,options)=>hookLogger('HOOK | onPasswordResetInputVerificationCodeSuccess',args,options),
        onPasswordResetFail : (args,options)=>hookLogger('HOOK | onPasswordResetFail',args,options),
        
        onConfirmNewPasswordSuccess : (args,options)=>hookLogger('HOOK | onConfirmNewPasswordSuccess',args,options),
        onConfirmNewPasswordFail : (args,options)=>hookLogger('HOOK | onConfirmNewPasswordFail',args,options),

        onAccountCreatedSuccess : (args,options)=>hookLogger('HOOK | onAccountCreatedSuccess',args,options),
        onAccountCreatedFail : (args,options)=>hookLogger('HOOK | onAccountCreatedFail',args,options),

        onUserVerifiedSuccess : (args,options)=>hookLogger('HOOK | onUserVerifiedSuccess',args,options),
        onUserVerifiedFail : (args,options)=>hookLogger('HOOK | onUserVerifiedFail',args,options),

        onGetUserSuccess : (args,options)=>hookLogger('HOOK | onGetUserSuccess',args,options),
        onGetUserFail : (args,options)=>hookLogger('HOOK | onGetUserFail',args,options),

        onRefreshSessionSuccess : (args,options)=>hookLogger('HOOK | onRefreshSessionSuccess',args,options),
        onRefreshSessionFail : (args,options)=>hookLogger('HOOK | onRefreshSessionFail',args,options),
    }
});
```

## Referrer
If a referrer is set in localstorage, then the sdk will redirect to that url on login.`localStorage.setItem('olyauth.referrer',window.location.href);`

## APP_CLIENT_ID
This is the Id of your User Pool

## USER_POOL_ID
The Id of the User Pool in Cognito that you'd like to use

## IDENTITY_POOL_ID
The Id of the Federated Identities Pool set up in Cognito. 
The APP_CLIENT_ID & USER_POOL_ID of your User Pool should be added as Cognito Authentication Providers in the Federated IDentity Pool settings.

##ENDPOINT_USERS
The GraphQL endpoint for your users service.

## ENDPOINT_APPS
The GraphQL endpoint for your apps service.


#### Monkey Patch
The node_modules/aws-sdk/lib/browsser.js file has been monkey patched with this line `if (typeof window !== 'undefined') window.STS = AWS.STS;// Monkey patch`. This enables STS to be available when running in the Meteor environment.

#### Resources
## s3
The `oly-users-service` bucket is used to store user folders on user create. The oly-sdk creates the bucket on user create


### Requirements
The application must have a route named "auth" that will be used as our callback and a safe route to host the Gate component

# Core Parts #
1. Users API
2. Connected App API
3. Oly AuthService for managing auth flow


## Features
1. On load hook to run code on page load

Notes:
The auth services works through the Users api. 
There are public methods in the auth service that the user service triggers on load to reveal the auth gate.

utils.OlyAuthMeta is where you theme the auth gate from.

## Gotchas ##
If you run into issues, first check that these packages are exactly these versions. AWS changed their sdk at some point after, introducing breaking changes


```
"aws-sdk":"2.7.9",
"amazon-cognito-identity-js":"1.8.0"
```
